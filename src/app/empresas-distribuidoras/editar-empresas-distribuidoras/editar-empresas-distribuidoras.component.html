<div class="layout">
  <app-header></app-header>

  <div class="layout-main">
    <div class="sidebar-container">
      <app-sidebar></app-sidebar>
    </div>

    <div class="container mt-4 editar-empresa">
      <h2>Editar empresa distribuidora</h2>

      <div *ngIf="loading" class="alert alert-info">Cargando…</div>
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

      <form *ngIf="!loading" (ngSubmit)="guardar()">
        <div class="grid-2">
          <!-- Nombre -->
          <div class="field">
            <label>Nombre</label>
            <input type="text" class="form-control"
                   [(ngModel)]="form.Nombre"
                   name="Nombre"
                   required
                   placeholder="Asignar nombre" />
          </div>

          <!-- Energético -->
          <div class="field">
            <label>Energético</label>
            <select class="form-select"
                    [(ngModel)]="form.EnergeticoId"
                    name="EnergeticoId"
                    required>
              <option [ngValue]="null">Selecciona energético</option>
              <option *ngFor="let e of energeticos" [ngValue]="e.Id">{{ e.Nombre }}</option>
            </select>
          </div>

          <!-- Regiones (multi) -->
          <div class="field">
            <label>Regiones</label>
            <select multiple class="form-select"
                    [(ngModel)]="form.RegionIds"
                    name="RegionIds"
                    (change)="onRegionsChange()">
              <option *ngFor="let r of regiones" [ngValue]="r.Id">{{ r.Nombre }}</option>
            </select>
            <small class="hint">Selecciona una o más regiones para filtrar comunas.</small>
          </div>

          <!-- Comunas (multi) -->
          <div class="field">
            <label>Comunas</label>
            <select multiple class="form-select"
                    [(ngModel)]="form.ComunaIds"
                    name="ComunaIds"
                    required>
              <option *ngFor="let c of comunasDisponibles" [ngValue]="c.Id">{{ c.Nombre }}</option>
            </select>
          </div>

          <!-- Activo -->
          <div class="field checkbox-span">
            <label>
              <input type="checkbox" [(ngModel)]="form.Active" name="Active" />
              Activo
            </label>
          </div>
        </div>

        <div class="buttons">
          <button type="submit" class="btn btn-primary" [disabled]="saving">Guardar</button>
          <button type="button" class="btn btn-outline" (click)="volver()">Volver</button>
        </div>
      </form>
    </div>
  </div>

  <app-footer></app-footer>
</div>
