<div class="layout">
  <app-header></app-header>

  <div class="layout-main">
    <div class="sidebar-container">
      <app-sidebar></app-sidebar>
    </div>

    <div class="container mt-4 crear-empresa-dist">
      <h2>Crear empresa distribuidora</h2>

      <!-- Estados -->
      <div *ngIf="loading" class="alert alert-info">Cargando…</div>
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

      <form *ngIf="!loading" (ngSubmit)="guardar()">
        <div class="grid">
          <!-- Nombre -->
          <div class="field">
            <label>Nombre</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="nombre"
              name="Nombre"
              placeholder="Asignar nombres"
              required
            />
          </div>

          <!-- Energético -->
          <div class="field">
            <label>Energético</label>
            <select
              class="form-control"
              [(ngModel)]="energeticoId"
              name="EnergeticoId"
              required
            >
              <option [ngValue]="null">Selecciona energético</option>
              <option *ngFor="let e of energeticos" [ngValue]="e.Id">{{ e.Nombre }}</option>
            </select>
          </div>

          <!-- Región (para cargar comunas) -->
          <div class="field">
            <label>Regiones</label>
            <select
              class="form-control"
              [(ngModel)]="regionId"
              name="RegionId"
              (ngModelChange)="onRegionChange()"
            >
              <option [ngValue]="null">Seleccionar una o más regiones</option>
              <option *ngFor="let r of regiones" [ngValue]="r.Id">{{ r.Nombre }}</option>
            </select>
          </div>

          <!-- Comunas (multi) -->
          <div class="field">
            <label>Comunas</label>
            <select
              class="form-control"
              multiple
              [(ngModel)]="comunaIds"
              name="ComunaIds"
              [disabled]="!regionId"
            >
              <option *ngFor="let c of comunas" [ngValue]="c.Id">{{ c.Nombre }}</option>
            </select>
            <small class="hint" *ngIf="regionId && comunas.length === 0">
              No hay comunas para la región seleccionada.
            </small>
          </div>
        </div>

        <div class="buttons">
          <button class="btn btn-primary" type="submit" [disabled]="saving">Guardar</button>
          <button class="btn btn-secondary" type="button" (click)="volver()">Volver</button>
        </div>
      </form>
    </div>
  </div>

  <app-footer></app-footer>
</div>
