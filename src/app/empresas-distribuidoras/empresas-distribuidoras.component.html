<div class="layout">
  <app-header></app-header>

  <div class="layout-main">
    <div class="sidebar-container">
      <app-sidebar></app-sidebar>
    </div>

    <div class="container mt-4 empresas-distribuidoras">
      <h2>Empresas Distribuidoras</h2>

      <div *ngIf="loading" class="alert alert-info">Cargando empresas distribuidoras…</div>
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

      <div class="filter-block" *ngIf="!loading && !error">
        <label class="filter-title">Filtrar por:</label>
        <div class="filter-line">
          <input
            type="text"
            class="form-control"
            placeholder="Nombre"
            [(ngModel)]="filtroNombre"
            name="filtroNombre"
          />

          <select class="form-control" [(ngModel)]="energeticoId" name="energeticoId">
            <option [ngValue]="null">Energéticos</option>
            <option *ngFor="let e of energeticos" [ngValue]="e.Id">{{ e.Nombre }}</option>
          </select>

          <select
            class="form-control"
            [(ngModel)]="regionId"
            name="regionId"
            (ngModelChange)="onRegionChange()"
          >
            <option [ngValue]="null">Regiones</option>
            <option *ngFor="let r of regiones" [ngValue]="r.Id">{{ r.Nombre }}</option>
          </select>

          <select class="form-control" [(ngModel)]="comunaId" name="comunaId" [disabled]="!regionId">
            <option [ngValue]="null">Comunas</option>
            <option *ngFor="let c of comunas" [ngValue]="c.Id">{{ c.Nombre }}</option>
          </select>

          <button class="btn btn-primary btn-filter" type="button" (click)="aplicarFiltro()">Filtrar<img src="/../icono-btn-filtrar.svg" alt="Icono de filtro" class="btn-icon"></button>
        </div>
      </div>

      <div class="header-row" *ngIf="!loading && !error">
        <span class="col-left">Nombre</span>
        <span class="col-mid">Energético</span>
        <span class="col-mid">Activo</span>
        <span class="col-right">Acciones</span>
      </div>
      <hr class="separator" *ngIf="!loading && !error" />

      <table class="table table-clean zebra" *ngIf="!loading && !error">
        <tbody>
          <tr *ngFor="let item of empresas; let i = index" [class.alt]="i % 2 === 1">
            <td class="col-nombre">
              <div class="row-chip">
                {{ item.Nombre || '—' }}
              </div>
            </td>

            <td class="col-energetico">
              <div class="row-chip">
                {{ energeticoLabel(item) }}
              </div>
            </td>

            <td class="col-activo">
              <label class="switch" [title]="isActivo(item) ? 'Activo' : 'Inactivo'">
                <input type="checkbox" [checked]="isActivo(item)" disabled />
                <span class="slider"></span>
              </label>
            </td>

            <td class="col-actions">
              <div class="actions">
                <button class="btn btn-sm btn-edit" type="button" (click)="editar(item)">Editar</button>
                <button class="btn btn-sm btn-delete" type="button" (click)="eliminar(item)">Eliminar</button>
              </div>
            </td>
          </tr>

          <tr *ngIf="empresas?.length === 0">
            <td colspan="4" class="empty">No hay empresas distribuidoras para mostrar.</td>
          </tr>
        </tbody>
      </table>

      <div class="footer-bar" *ngIf="!loading && !error">
        <nav *ngIf="totalPaginas > 1" class="paginacion">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="pagina === 1">
              <button class="page-link" (click)="irA(pagina - 1)">&lt;</button>
            </li>

            <li
              class="page-item"
              *ngFor="let pageNum of getPaginasArray()"
              [class.active]="pagina === pageNum"
            >
              <button class="page-link" (click)="irA(pageNum)">{{ pageNum }}</button>
            </li>

            <li class="page-item" [class.disabled]="pagina === totalPaginas">
              <button class="page-link" (click)="irA(pagina + 1)">&gt;</button>
            </li>
          </ul>
        </nav>

        <div class="bottom-actions">
          <button class="btn btn-primary btn-create" type="button" (click)="crearNuevo()">
            Crear nuevo
          </button>
          <button class="btn btn-secondary" type="button" (click)="volver()">Volver</button>
        </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>
