<div class="layout">
  <app-header></app-header>

  <div class="layout-main">
    <div class="sidebar-container">
      <app-sidebar></app-sidebar>
    </div>

    <div class="container mt-4 usuarios">
      <h2>Usuarios</h2>

      <div *ngIf="loading" class="alert alert-info">Cargando usuarios...</div>
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>
      <div *ngIf="!loading && !error && usuarios.length === 0" class="alert alert-warning">
        No hay usuarios para mostrar.
      </div>

      <!-- Filtros (solo visual) -->
      <div class="filter-block" *ngIf="!loading && !error">
        <label class="filter-title">Filtrar por:</label>
        <div class="filter-line">
          <input type="text" class="form-control" placeholder="Nombre" />
          <input type="text" class="form-control" placeholder="Rut" />
          <select class="form-select"><option selected>Servicio</option></select>
          <select class="form-select"><option selected>Inmueble</option></select>
          <select class="form-select"><option selected>Comuna</option></select>
          <button class="btn btn-primary btn-filter" type="button">
            Filtrar <img src="/../icono-btn-filtrar.svg" alt="Icono de filtro" class="btn-icon">
          </button>
        </div>
      </div>

      <!-- Encabezado + separador -->
      <div class="header-row" *ngIf="!loading && !error && usuarios.length > 0">
        <span class="col-name">Nombres</span>
        <span class="col-last">Apellidos</span>
        <span class="col-email">Email</span>
        <span class="col-active">Activo</span>
        <span class="col-actions">Acciones</span>
      </div>
      <hr class="separator" *ngIf="!loading && !error && usuarios.length > 0" />

      <!-- Tabla limpia con zebra -->
      <table *ngIf="!loading && !error && usuarios.length > 0" class="table table-clean">
        <tbody>
          <tr *ngFor="let usuario of usuariosPaginados; let i = index">
            <td class="col-name">
              {{ ((usuario.full_name || '').split(' '))[0] || '—' }}
            </td>
            <td class="col-last">
              {{ ((usuario.full_name || '').split(' ').slice(1).join(' ')) || '—' }}
            </td>
            <td class="col-email">{{ usuario.email || '—' }}</td>
            <td class="col-active"><input type="checkbox" class="form-check" disabled /></td>
            <td class="col-actions">
              <div class="actions">
                <button class="btn btn-sm btn-edit" type="button">Editar</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Barra inferior: paginación + botones -->
      <div class="footer-bar" *ngIf="!loading && !error && usuarios.length > 0">
        <nav *ngIf="totalPaginas > 1" class="paginacion">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="paginaActual === 1">
              <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">&lt;</button>
            </li>

            <li
              class="page-item"
              *ngFor="let _ of [].constructor(totalPaginas); let i = index"
              [class.active]="paginaActual === (i + 1)">
              <button class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</button>
            </li>

            <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
              <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">&gt;</button>
            </li>
          </ul>
        </nav>

        <div class="bottom-actions">
          <button class="btn btn-primary btn-create" (click)="crearNuevoUsuario()">Crear nuevo</button>
          <button class="btn btn-secondary" type="button" (click)="volver()">Volver</button>
        </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>
