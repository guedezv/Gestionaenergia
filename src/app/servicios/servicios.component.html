<div class="layout">
  <app-header></app-header>

  <div class="layout-main">
    <div class="sidebar-container">
      <app-sidebar></app-sidebar>
    </div>

    <div class="container mt-4 servicios">
      <h2>Servicios</h2>

      <!-- Mensajes (toast opcional) -->
      <div *ngIf="toast as t">
        <div *ngIf="t.type === 'success'" class="alert alert-success">{{ t.text }}</div>
        <div *ngIf="t.type === 'error'"   class="alert alert-danger">{{ t.text }}</div>
        <div *ngIf="t.type === 'info'"    class="alert alert-info">{{ t.text }}</div>
      </div>

      <div *ngIf="loading" class="alert alert-info">Cargando servicios…</div>
      <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

      <!-- Filtros -->
      <div class="filter-block" *ngIf="!loading">
        <label class="filter-title">Filtrar por:</label>
        <div class="filter-line">
          <input
            type="text"
            class="form-control"
            placeholder="Nombre del servicio"
            [(ngModel)]="filtroTexto"
            name="filtroNombre"
          />

          <select
            class="form-select"
            [(ngModel)]="institucionSeleccionada"
            name="filtroInstitucion"
            (ngModelChange)="onInstChange($event)">
            <option [ngValue]="null">Todas las instituciones</option>
            <option *ngFor="let i of instituciones" [ngValue]="i.Id">
              {{ i.Nombre }}
            </option>
          </select>

          <button class="btn btn-primary btn-filter" (click)="aplicarFiltro()">
            Filtrar <img src="/../icono-btn-filtrar.svg" alt="Icono de filtro" class="btn-icon">
          </button>
        </div>
      </div>

      <!-- Tabla estilo “chip” (como tu ejemplo) -->
<table class="table table-clean" *ngIf="!loading">
  <thead>
    <tr class="table-head">
      <th class="col-id">ID</th>
      <th class="col-nombre">Nombre</th>
      <th class="col-actions">Acciones</th>
    </tr>
  </thead>

  <!-- Separador bajo el thead -->
  <tbody class="thead-separator">
    <tr>
      <td colspan="3">
        <hr class="table-hr">
      </td>
    </tr>
  </tbody>

  <!-- Datos -->
  <tbody class="data-body">
    <tr class="chip-row" *ngFor="let srv of serviciosPaginados">
      <td class="col-id">{{ srv.Id ?? '—' }}</td>
      <td class="col-nombre">
        <span class="srv-name">{{ srv.Nombre || '—' }}</span>
      </td>
<td class="col-actions">
  <div class="actions">
    <button class="btn btn-sm btn-edit" (click)="editarServicio(srv)">
      Editar
    </button>

    <!-- ⭐ Switch activar/desactivar -->
    <label class="switch">
      <input
        type="checkbox"
        [checked]="isActivo(srv)"
        [disabled]="togglingId === srv.Id"
        (change)="onToggleEstado(srv, $any($event.target).checked)" />
      <span class="slider"></span>
    </label>
  </div>
</td>

    </tr>

    <tr *ngIf="!servicios?.length || !serviciosPaginados?.length">
      <td colspan="3" class="empty">No hay servicios para mostrar.</td>
    </tr>
  </tbody>
</table>


      <div class="uni">
      <!-- Paginación -->
      <nav *ngIf="!loading && totalPaginas > 1" class="paginacion">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="paginaActual === 1">
            <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">&lt;</button>
          </li>

          <li
            class="page-item"
            *ngFor="let _ of [].constructor(totalPaginas); let i = index"
            [class.active]="paginaActual === (i + 1)">
            <button class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</button>
          </li>

          <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
            <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">&gt;</button>
          </li>
        </ul>
      </nav>

      <!-- Botonera -->
      <div class="bottom-actions">
        <button class="btn btn-primary btn-create" (click)="crearNuevoServicio()">Crear nuevo</button>
        <button class="btn btn-secondary" (click)="volver()">Volver</button>
      </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>
